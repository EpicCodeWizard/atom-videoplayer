(function(l){function d(a,b){if(null==b)return null;null==b.__id__&&(b.__id__=m++);var e;null==a.hx__closures__?a.hx__closures__={}:e=a.hx__closures__[b.__id__];null==e&&(e=b.bind(a),a.hx__closures__[b.__id__]=e);return e}var f=function(){};f.substr=function(a,b,e){if(null==e)e=a.length;else if(0>e)if(0==b)e=a.length+e;else return"";return a.substr(b,e)};f.iter=function(a){return{cur:0,arr:a,hasNext:function(){return this.cur<this.arr.length},next:function(){return this.arr[this.cur++]}}};var h=function(){};
h.has=function(a,b){a=a instanceof Array?f.iter(a):a.iterator();for(;a.hasNext();)if(a.next()==b)return!0;return!1};var c=l.VideoPlayer=function(a){var b=this;this.file=new n(a.path);this.isPlaying=!1;this.wheelSpeed=this.seekSpeed=1;this.element=window.document.createElement("div");this.element.classList.add("videoplayer");this.element.setAttribute("tabindex","-1");atom.config.get("videoplayer.background.transparent")||(this.element.style.background=atom.config.get("videoplayer.background.color").toHexString());
this.video=window.document.createElement("video");this.video.controls=!0;this.video.src=this.file.getPath();null!=a.time&&(this.video.currentTime=a.time);null!=a.volume&&(this.video.volume=a.volume);this.element.appendChild(this.video);this.element.addEventListener("DOMNodeInserted",d(this,this.handleInsertDOM),!1);this.video.addEventListener("canplaythrough",d(this,this.handleVideoCanPlay),!1);this.video.addEventListener("playing",d(this,this.handleVideoPlay),!1);this.video.addEventListener("ended",
d(this,this.handleVideoEnd),!1);this.video.addEventListener("error",d(this,this.handleVideoError),!1);this.commands=new k;this.addCommand("toggle-controls",function(a){return b.video.controls=!b.video.controls});this.addCommand("toggle-mute",d(this,this.toggleMute));this.addCommand("toggle-playback",d(this,this.togglePlayback));this.addCommand("seek-backward",function(a){b.seek(-b.calcSeekValue(null!=a.originalEvent&&a.originalEvent.shiftKey))});this.addCommand("seek-forward",function(a){a=b.calcSeekValue(null!=
a.originalEvent&&a.originalEvent.shiftKey);b.seek(a)});this.addCommand("goto-start",function(a){return b.video.currentTime=0});this.addCommand("goto-end",function(a){return b.video.currentTime=b.video.duration});a.play&&this.play();a.mute&&(this.video.muted=!0)};c.activate=function(a){c.disposables=new k;c.disposables.add(atom.workspace.addOpener(c.openURI));atom.workspace.onDidChangeActivePaneItem(function(a){null!=c.statusbar&&(a instanceof c?p.stat(a.file.getPath(),function(b,d){null!=b?(c.statusbar.style.display=
"none",c.statusbar.textContent=""):(c.statusbar.textContent=a.video.videoWidth+"x"+a.video.videoHeight+" "+(d.size/1E6|0)+"mb",c.statusbar.style.display="inline-block")}):(c.statusbar.style.display="none",c.statusbar.textContent=""))})};c.deactivate=function(){c.disposables.dispose();null!=c.statusbar&&c.statusbar.remove()};c.openURI=function(a){var b=g.extension(a).toLowerCase();return h.has(c.allowedFileTypes,b)?(a=new c({path:a,time:null,volume:atom.config.get("videoplayer.playback.volume"),play:atom.config.get("videoplayer.playback.autoplay"),
mute:!1}),c.disposables.add(a),a):null};c.consumeStatusBar=function(a){var b=window.document.createElement("div");b.classList.add("status-bar-videoplayer","inline-block","icon","file-media");b.style.display="none";a.addRightTile({item:c.statusbar=b,priority:100})};c.deserialize=function(a){return new c(a)};c.prototype={addCommand:function(a,b){this.commands.add(atom.commands.add(".videoplayer","videoplayer:"+a,b))},serialize:function(){return{deserializer:"VideoPlayer",mute:this.video.muted,path:this.file.getPath(),
play:!this.video.paused,time:this.video.currentTime,volume:this.video.volume}},dispose:function(){this.commands.dispose();this.element.removeEventListener("DOMNodeInserted",d(this,this.handleInsertDOM));this.video.removeEventListener("canplaythrough",d(this,this.handleVideoCanPlay));this.video.removeEventListener("playing",d(this,this.handleVideoPlay));this.video.removeEventListener("ended",d(this,this.handleVideoEnd));this.video.removeEventListener("error",d(this,this.handleVideoError));this.video.removeEventListener("click",
d(this,this.handleVideoClick));this.video.removeEventListener("mousewheel",d(this,this.handleMouseWheel));this.video.style.display="none";this.video.pause();this.video.remove();this.video=null},getPath:function(){return this.file.getPath()},getTitle:function(){return this.file.getBaseName()},getIconName:function(){return"file-media"},getURI:function(){return this.getPath()},getEncodedURI:function(){var a=this.getPath();return"file://"+encodeURIComponent(a)},isEqual:function(a){return a instanceof
c},togglePlayback:function(){this.isPlaying?this.pause():this.play()},toggleMute:function(){this.video.muted=!this.video.muted},play:function(){this.isPlaying||(this.isPlaying=!0,this.video.play())},pause:function(){this.isPlaying&&(this.isPlaying=!1,this.video.pause())},seek:function(a){null!=this.video.currentTime&&(this.video.currentTime+=a);return this.video.currentTime},calcSeekValue:function(a,b,c,d){null==d&&(d=30);null==c&&(c=1);null==b&&(b=100);null==a&&(a=!1);b=this.video.duration/b;b=Math.min(d,
Math.max(c,b));a&&(b*=3);return b},handleInsertDOM:function(a){this.isPlaying&&this.video.play()},handleVideoCanPlay:function(a){this.video.removeEventListener("canplaythrough",d(this,this.handleVideoCanPlay));this.video.addEventListener("click",d(this,this.handleVideoClick),!1);this.video.addEventListener("mousewheel",d(this,this.handleMouseWheel),!1);c.statusbar.textContent=this.video.videoWidth+"x"+this.video.videoHeight},handleVideoPlay:function(a){this.isPlaying=!0;this.video.style.display="inline-block"},
handleVideoEnd:function(a){this.isPlaying=!1;atom.isFullScreen()&&atom.toggleFullScreen()},handleVideoError:function(a){this.isPlaying=!1;atom.isFullScreen()&&atom.toggleFullScreen()},handleVideoClick:function(a){this.isPlaying?this.pause():this.play()},handleMouseWheel:function(a){var b=a.wheelDelta/100*this.wheelSpeed;a.ctrlKey&&(b*=10,a.shiftKey&&(b*=10));this.seek(b)}};var k=require("atom").CompositeDisposable,n=require("atom").File,g=function(a){switch(a){case ".":case "..":this.dir=a;this.file=
"";return}var b=a.lastIndexOf("/"),c=a.lastIndexOf("\\");b<c?(this.dir=f.substr(a,0,c),a=f.substr(a,c+1,null),this.backslash=!0):c<b?(this.dir=f.substr(a,0,b),a=f.substr(a,b+1,null)):this.dir=null;b=a.lastIndexOf(".");-1!=b?(this.ext=f.substr(a,b+1,null),this.file=f.substr(a,0,b)):(this.ext=null,this.file=a)};g.extension=function(a){a=new g(a);return null==a.ext?"":a.ext};var p=require("fs"),m=0;module.exports=c;c.allowedFileTypes="3gp avi mov mp4 m4v mkv ogv ogm webm".split(" ")})("undefined"!=typeof exports?
exports:"undefined"!=typeof window?window:"undefined"!=typeof self?self:this);
