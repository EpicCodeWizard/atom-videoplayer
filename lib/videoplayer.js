(function(p,q){function r(a){return a instanceof Array?function(){return g.iter(a)}:"function"==typeof a.iterator?f(a,a.iterator):a.iterator}function f(a,b){if(null==b)return null;null==b.__id__&&(b.__id__=t++);var d;null==a.hx__closures__?a.hx__closures__={}:d=a.hx__closures__[b.__id__];null==d&&(d=function(){return d.method.apply(d.scope,arguments)},d.scope=a,d.method=b,a.hx__closures__[b.__id__]=d);return d}var g=function(){};g.__name__=!0;g.substr=function(a,b,d){if(null==d)d=a.length;else if(0>
d)if(0==b)d=a.length+d;else return"";return a.substr(b,d)};g.iter=function(a){return{cur:0,arr:a,hasNext:function(){return this.cur<this.arr.length},next:function(){return this.arr[this.cur++]}}};var k=function(){};k.__name__=!0;k.has=function(a,b){for(var d=r(a)();d.hasNext();)if(d.next()==b)return!0;return!1};Math.__name__=!0;var c=p.VideoPlayer=function(a){var b=this;this.file=new u(a.path);this.isPlaying=!1;this.wheelSpeed=this.seekSpeed=1;this.element=window.document.createElement("div");this.element.classList.add("videoplayer");
this.element.setAttribute("tabindex","-1");atom.config.get("videoplayer.background.transparent")||(this.element.style.background=atom.config.get("videoplayer.background.color").toHexString());this.video=window.document.createElement("video");this.video.controls=!0;this.video.src=this.file.getPath();null!=a.time&&(this.video.currentTime=a.time);null!=a.volume&&(this.video.volume=a.volume);this.element.appendChild(this.video);this.element.addEventListener("DOMNodeInserted",f(this,this.handleInsertDOM),
!1);this.video.addEventListener("canplaythrough",f(this,this.handleVideoCanPlay),!1);this.video.addEventListener("playing",f(this,this.handleVideoPlay),!1);this.video.addEventListener("ended",f(this,this.handleVideoEnd),!1);this.video.addEventListener("error",f(this,this.handleVideoError),!1);this.video.addEventListener("click",f(this,this.handleVideoClick),!1);this.commands=new l;this.commands.add(atom.commands.add(this.element,"videoplayer:toggle-playback",function(a){b.isPlaying?b.pause():b.play()}));
this.commands.add(atom.commands.add(this.element,"videoplayer:seek-backward",function(a){b.seek(-b.calcSeekValue(null!=a.originalEvent&&a.originalEvent.shiftKey))}));this.commands.add(atom.commands.add(this.element,"videoplayer:seek-forward",function(a){b.seek(b.calcSeekValue(null!=a.originalEvent&&a.originalEvent.shiftKey))}));this.commands.add(atom.commands.add(this.element,"videoplayer:goto-start",function(a){b.video.currentTime=0}));this.commands.add(atom.commands.add(this.element,"videoplayer:goto-end",
function(a){b.video.currentTime=b.video.duration}));this.commands.add(atom.commands.add(this.element,"videoplayer:toggle-mute",function(a){b.video.muted=!b.video.muted}));a.play&&this.play();a.mute&&(this.video.muted=!0)};c.__name__=!0;c.activate=function(a){c.disposables=new l;c.disposables.add(atom.workspace.addOpener(c.openURI));atom.workspace.onDidChangeActivePaneItem(function(a){null!=c.statusbar&&(e.__instanceof(a,c)?v.stat(a.file.getPath(),function(d,e){null!=d?(c.statusbar.style.display="none",
c.statusbar.textContent=""):(c.statusbar.textContent=a.video.videoWidth+"x"+a.video.videoHeight+" "+(e.size/1E6|0)+"mb",c.statusbar.style.display="inline-block")}):(c.statusbar.style.display="none",c.statusbar.textContent=""))})};c.deactivate=function(){c.disposables.dispose();null!=c.statusbar&&c.statusbar.remove()};c.openURI=function(a){var b=h.extension(a).toLowerCase();return k.has(c.allowedFileTypes,b)?new c({path:a,time:null,volume:atom.config.get("videoplayer.playback.volume"),play:atom.config.get("videoplayer.playback.autoplay"),
mute:!1}):null};c.consumeStatusBar=function(a){var b=window.document.createElement("div");b.classList.add("status-bar-videoplayer","inline-block","icon","file-media");b.style.display="none";a.addRightTile({item:c.statusbar=b,priority:100})};c.deserialize=function(a){return new c(a)};c.prototype={serialize:function(){return{deserializer:"VideoPlayer",path:this.file.getPath(),time:this.video.currentTime,volume:this.video.volume,play:!this.video.paused,mute:this.video.muted}},dispose:function(){this.commands.dispose();
this.element.removeEventListener("mousewheel",f(this,this.handleMouseWheel));this.element.removeEventListener("DOMNodeInserted",f(this,this.handleInsertDOM));this.video.removeEventListener("canplaythrough",f(this,this.handleVideoCanPlay));this.video.removeEventListener("playing",f(this,this.handleVideoPlay));this.video.removeEventListener("ended",f(this,this.handleVideoEnd));this.video.removeEventListener("error",f(this,this.handleVideoError));this.video.removeEventListener("click",f(this,this.handleVideoClick));
this.video.pause();this.video.remove();this.video=null},getPath:function(){return this.file.getPath()},getTitle:function(){return this.file.getBaseName()},getIconName:function(){return"file-media"},getURI:function(){return this.getPath()},getEncodedURI:function(){var a=this.getPath();return"file://"+encodeURIComponent(a)},isEqual:function(a){return e.__instanceof(a,c)},togglePlayback:function(){this.isPlaying?this.pause():this.play()},toggleMute:function(){this.video.muted=!this.video.muted},play:function(){this.isPlaying||
(this.isPlaying=!0,this.video.play())},pause:function(){this.isPlaying&&(this.isPlaying=!1,this.video.pause())},seek:function(a){null!=this.video.currentTime&&(this.video.currentTime+=a);return this.video.currentTime},calcSeekValue:function(a,b,d,c){null==c&&(c=30);null==d&&(d=1);null==b&&(b=100);null==a&&(a=!1);b=this.video.duration/b;b=Math.min(c,Math.max(d,b));a&&(b*=3);return b},handleInsertDOM:function(a){this.isPlaying&&this.video.play()},handleVideoCanPlay:function(a){this.video.removeEventListener("canplaythrough",
f(this,this.handleVideoCanPlay));this.element.addEventListener("mousewheel",f(this,this.handleMouseWheel),!1);c.statusbar.textContent=this.video.videoWidth+"x"+this.video.videoHeight},handleVideoPlay:function(a){this.isPlaying=!0},handleVideoEnd:function(a){this.isPlaying=!1;atom.isFullScreen()&&atom.toggleFullScreen()},handleVideoError:function(a){this.isPlaying=!1;atom.isFullScreen()&&atom.toggleFullScreen()},handleVideoClick:function(a){},handleMouseWheel:function(a){var b=a.wheelDelta/100*this.wheelSpeed;
a.ctrlKey&&(b*=10,a.shiftKey&&(b*=10));this.seek(b)},__class__:c};var l=require("atom").CompositeDisposable,u=require("atom").File,h=function(a){switch(a){case ".":case "..":this.dir=a;this.file="";return}var b=a.lastIndexOf("/"),c=a.lastIndexOf("\\");b<c?(this.dir=g.substr(a,0,c),a=g.substr(a,c+1,null),this.backslash=!0):c<b?(this.dir=g.substr(a,0,b),a=g.substr(a,b+1,null)):this.dir=null;b=a.lastIndexOf(".");-1!=b?(this.ext=g.substr(a,b+1,null),this.file=g.substr(a,0,b)):(this.ext=null,this.file=
a)};h.__name__=!0;h.extension=function(a){a=new h(a);return null==a.ext?"":a.ext};h.prototype={__class__:h};var e=function(){};e.__name__=!0;e.getClass=function(a){if(a instanceof Array&&null==a.__enum__)return Array;var b=a.__class__;if(null!=b)return b;a=e.__nativeClassName(a);return null!=a?e.__resolveNativeClass(a):null};e.__interfLoop=function(a,b){if(null==a)return!1;if(a==b)return!0;var c=a.__interfaces__;if(null!=c)for(var f=0,g=c.length;f<g;){var h=c[f++];if(h==b||e.__interfLoop(h,b))return!0}return e.__interfLoop(a.__super__,
b)};e.__instanceof=function(a,b){if(null==b)return!1;switch(b){case Array:return a instanceof Array?null==a.__enum__:!1;case m:return"boolean"==typeof a;case w:return!0;case n:return"number"==typeof a;case x:return"number"==typeof a?(a|0)===a:!1;case String:return"string"==typeof a;default:if(null!=a)if("function"==typeof b){if(a instanceof b||e.__interfLoop(e.getClass(a),b))return!0}else{if("object"==typeof b&&e.__isNativeObj(b)&&a instanceof b)return!0}else return!1;return b==y&&null!=a.__name__||
b==z&&null!=a.__ename__?!0:a.__enum__==b}};e.__nativeClassName=function(a){a=e.__toStr.call(a).slice(8,-1);return"Object"==a||"Function"==a||"Math"==a||"JSON"==a?null:a};e.__isNativeObj=function(a){return null!=e.__nativeClassName(a)};e.__resolveNativeClass=function(a){return q[a]};var v=require("fs");require("buffer");var t=0;String.prototype.__class__=String;String.__name__=!0;Array.__name__=!0;var x={__name__:["Int"]},w={__name__:["Dynamic"]},n=Number;n.__name__=["Float"];var m=Boolean;m.__ename__=
["Bool"];var y={__name__:["Class"]},z={};module.exports=c;c.allowedFileTypes="3gp avi mov mp4 m4v mkv ogv ogm webm".split(" ");e.__toStr={}.toString})("undefined"!=typeof exports?exports:"undefined"!=typeof window?window:"undefined"!=typeof self?self:this,"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this);
